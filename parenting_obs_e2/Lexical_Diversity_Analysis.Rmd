---
title: "Parenting Observation Experiment 2 Lexical Diversity Analysis"
author: "Vivian & George"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

# Data preprocessing

Preliminaries.

```{r include=FALSE}
knitr::opts_chunk$set(fig.width=8, fig.height=5, 
                      echo=TRUE, warning=FALSE, message=FALSE, cache = TRUE)
suppressPackageStartupMessages(c("dplyr","langcog","tidyr","ggplot2","lme4"))
library(psych)
library(langcog)
library(tidyverse)
library(ggthemes)
library(lme4)
library(lmerTest)

select <- dplyr::select # masked by MASS
theme_set(theme_few())
```

Read in participant data.

```{r}
data <- read.csv("MTLD_HDD.csv", header =TRUE) # generated by get_all_parent_speech.py
# dem <- read.csv("parenting_proj_emilyhembacher_demo2016.csv", header =TRUE)
conditions <- read.csv("conditions.csv")
```

Make data frames. 

```{r}
d <- left_join(data, conditions, by = "sid")
d$condition [d$sid=="111517_3"] = "exp"
d$video [d$sid=="111517_3"] = "big_small"
d$age [d$sid=="111517_3"] = "2"

dem <- read.csv("anonymized_demographics_parenting_obs_e2.csv", header=T)
dem$age = as.numeric(as.character(dem$age))
d$age = NULL
dem$X = NULL
d <- d %>% left_join(dem, by=c("sid" = "SID")) %>%
  filter(age <= 2.0 & age>=1.0)

d$Condition <- factor(d$condition, levels=c("con","exp"), labels=c("Control","Video"))
#save(d, file="Exp2_cleaned_data.Rdata")
```

# Plots

## TTR

```{r echo=FALSE}
ms_lex <- d %>%
  group_by(condition) %>%
  multi_boot_standard(col = "TTR") 

ms_lex$condition <- factor(ms_lex$condition,
levels = c("con", "exp"),
labels = c("Control", "Video"))

ggplot(ms_lex, aes(x = condition, y = mean, fill = condition)) + 
  ylim(0.0, 0.6) + geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Condition") + ylab("TTR") + langcog::scale_colour_solarized() + ggthemes::theme_few() 
ggsave(file="figs/e2_TTR.pdf", width=3, height=3)
```

## MTLD

```{r echo=FALSE}
ms_lex <- d %>%
  group_by(condition) %>%
  multi_boot_standard(col = "MTLD") 

ms_lex$condition <- factor(ms_lex$condition,
levels = c("con", "exp"),
labels = c("Control", "Video"))

ggplot(ms_lex, aes(x = condition, y = mean, fill = condition)) + 
  geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Condition") + 
  ylab("MTLD") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_few() 
ggsave(file="figs/e2_MTLD.pdf", width=3, height=3)
```


## Word Tokens

```{r echo=FALSE}
ms_tok <- d %>%
  group_by(condition) %>%
  multi_boot_standard(col = "tokens") 

ms_tok$condition <- factor(ms_tok$condition,
levels = c("con", "exp"),
labels = c("Control", "Video"))

ggplot(ms_tok, aes(x = condition, y = mean, fill = condition)) + 
  geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Condition") + 
  ylab("Total Number of Word Tokens") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_few() 
ggsave(file="figs/e2_tokens.pdf", width=3, height=3)
```

## Word Types

```{r echo=FALSE}
ms_type <- d %>%
  group_by(condition) %>%
  multi_boot_standard(col = "types") 

ms_type$condition <- factor(ms_type$condition,
levels = c("con", "exp"),
labels = c("Control", "Video"))

ggplot(ms_type, aes(x = condition, y = mean, fill = condition)) +
  ylim(0, 100)+
  geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Condition") + 
  ylab("Total Number of Word Types") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_few() 
ggsave(file="figs/e2_types.pdf", width=3, height=3)
```

## Sentence Length

```{r echo=FALSE}
slen <- lmer(len_sentence ~ condition * age + (1|video), data=d)
summary(slen)

ms_length <- d %>%
  group_by(condition) %>%
  multi_boot_standard(col = "len_sentence") 

ms_length$condition <- factor(ms_length$condition,
levels = c("con", "exp"),
labels = c("Control", "Video"))

ggplot(ms_length, aes(x = condition, y = mean, fill = condition)) +
  ylim(0,4.5)+
  geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Condition") + 
  ylab("Average Sentence Length") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_few()
ggsave(file="figs/e2_sentence_length.pdf", width=3, height=3)
```

### Sentence Length by Video

```{r echo=FALSE}
ms_length <- d %>%
  group_by(video) %>%
  multi_boot_standard(col = "len_sentence") 

ms_length$video <- factor(ms_length$video,
levels = c("give_me_toy", "big or small", "puzzle", "Hamlin", "Feigenson", "Gopnik","big_small", "orchestra","color", "Lany", "Warneken", "Adolph"),
labels = c("give_me_toy", "big or small_young", "puzzle", "Hamlin", "Feigenson", "Gopnik","big_small_old", "orchestra","color", "Lany", "Warneken", "Adolph"))

ggplot(ms_length, aes(x = video, y = mean, fill = video)) +
  geom_bar(stat="identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))+
  xlab("Videos") + 
  ylab("Average Sentence Length") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_few() + 
  theme(legend.title = element_text(size=18), 
        legend.text = element_text(size=16), 
        axis.text.x  = element_text(vjust=0.5, size=16),
        axis.title.x = element_text(size=18), 
        axis.text.y  = element_text(vjust=0.5, size=16),
        axis.title.y = element_text(size=18))
```

### Sentence Length by age
(Maybe do a scatterplot with continuous age)

```{r echo=FALSE}
ac <- d %>% filter(!is.na(age) & !is.na(condition))
ggplot(ac, aes(x = age, y = len_sentence, group=condition, colour = condition)) +
  geom_point(alpha=.7) + geom_smooth(method='lm') + 
  xlab("Age (years)") + ylab("Mean Sentence Length") +
  langcog::scale_colour_solarized() +
  ggthemes::theme_few() 
```



## Interindex correlations

```{r}

round(cor(d[,c("TTR","MTLD","HDD","len_sentence")]), 3)

```

# Conclusions

In McCarthy-Jarvis2010 paper, MTLD and HD-D has a correlation of r = .800; MTLD and TTR r =.322; HD-D and TTR r = -.051 (N = 1584). 
In our results, MTLD and HD-D have the highest correlation (r = .710). Meanwhile, MTLD and TTR has r = .287, a bit lower than what M-J2010 reported. TTR and HDD are also modestly correlated (r = .444).

All of the measures suggest that the control group has higher lexical diversity than experimental group, with HD-D showing the biggest contrast and MTLD the smallest.
